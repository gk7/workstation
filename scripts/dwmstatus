#!/bin/bash

music(){
title="$(ncmpcpp --now-playing "{%t}|{%f}")"
time="$(mpc -f "%position%" | awk 'NR==2 {print $3}')"
STATUS="$(mpc status | awk 'NR==2 {print $1}' | sed 's/^.\{,1\}//' | sed 's/.\{1\}$//')"
if [[ $STATUS ==  playing ]]; then
	echo -e "\x05æ\x01 $title\x05[\x01$time\x05]"
elif  [[ $STATUS == paused ]]; then 
	echo -e "\x03ç\x01 $title\x02[\x01$time\x02]"
else 
	echo -e ""
fi
}

cpu(){
        read cpu a b c previdle rest < /proc/stat
        prevtotal=$((a+b+c+previdle))
        sleep 0.5
        read cpu a b c idle rest < /proc/stat
        total=$((a+b+c+idle))
        cpu="$((100*( (total-prevtotal) - (idle-previdle) ) / (total-prevtotal) ))"
        echo -e "\x05Ñ\x01$cpu%"
}

#cputemp(){
#	temp="$(acpi -t | awk '{printf("%d", $4)}')"
#	echo -e "\x05^\x01$temp°c"
#}

hdd(){
	hd="$(df -hlT / | awk 'NR==2 {print $4}'| sed 's/.\{1\}$//')"
	echo -e "\x05¨\x01$hd G"
}

mem(){
        mem="$(awk '/^-/ {print $3}' <(free -m))"
        echo -e "\x05Î\x01$mem MB"
}

netdown(){
	netdown="$(ifconfig | awk 'NR==13 {print $6,$7}' | sed 's/^.\{,1\}//' | sed 's/.\{3\}$//')" # NR==14 on non lts kernel
	if [ -n "$netdown" ]; then
	echo -e "\x05Ý\x01$netdown"
	fi
}

netup(){
	netup="$(ifconfig | awk 'NR==15 {print $6,$7}' | sed 's/^.\{,1\}//' | sed 's/.\{3\}$//')" # NR==16 on non lts kernel
	if [ -z "$netup" ]; then
	echo -e "\x03No Internet"
	else
	echo -e "\x05Ü\x01$netup"
	fi
}

vol(){
	op1="$(amixer get Master| awk 'NR==6 {print $5}'| sed 's/^.\{,1\}//' | sed 's/.\{1\}$//')"
	op2="$(amixer get Master| awk 'NR==6 {print $6}'| sed 's/^.\{,1\}//' | sed 's/.\{1\}$//')" 
	head="$(cat /proc/asound/card0/codec#0 | grep Power-Map | awk '{print $2}' | sed 's/^.\{,3\}//')"
	if [[ $op2 == on && $head == 0 ]]; then
		echo -e "\x05à\x01$op1"
	elif [[ $op2 == on && $head == 1 ]]; then
		echo -e "\x05í\x01$op1"
	else
		echo -e "\x05ë\x01Mute"
	fi
}

dte(){
 ##       dte="$(date "+%a %d %b %I:%M %p")"
        dte="$(date "+%a %I:%M %p")"
        echo -e "\x05É\x01$dte"
}

power(){
adapter="$(acpi -V | awk 'NR==3 {print $3}' | sed 's/.\{5\}$//')"
battery="$(acpi -V | awk 'NR==1 {print $4}' | sed 's/.\{1\}$//')"

	if [[ $adapter == on ]]; then
		echo -e "\x05Â\x01AC"
	else 
		echo -e "\x03ï\x01BAT:$battery"
	fi
}

# Status bar
xsetroot -name "$(music) $(cpu) $(hdd) $(mem) $(netdown) $(netup) $(vol) $(dte) $(power)"
